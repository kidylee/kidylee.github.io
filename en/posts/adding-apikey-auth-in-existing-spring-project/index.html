<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>How to Add API Key Access Method for Spring Projects - An Li's Blog</title><meta name=Description content="Learning, Thinking and Practicing."><meta property="og:title" content="How to Add API Key Access Method for Spring Projects"><meta property="og:description" content="Most technical SaaS platforms provide APIs for developers or to support clients and SDKs, and our company is no exception. Although saving OAuth2 tokens in browsers is convenient, tokens have expiration times and are issued by third parties, which can be a potential risk for clients and SDKs. Often, issues with third-party authentication services cause users to be unable to log in. Therefore, providing API Key access has become a better choice."><meta property="og:type" content="article"><meta property="og:url" content="http://kidylee.com/en/posts/adding-apikey-auth-in-existing-spring-project/"><meta property="og:image" content="https://source.unsplash.com/lPQIndZz8Mo/w=800"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-08-28T23:52:24+08:00"><meta property="article:modified_time" content="2022-08-28T23:52:24+08:00"><meta property="og:site_name" content="An Li's Blog"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://source.unsplash.com/lPQIndZz8Mo/w=800"><meta name=twitter:title content="How to Add API Key Access Method for Spring Projects"><meta name=twitter:description content="Most technical SaaS platforms provide APIs for developers or to support clients and SDKs, and our company is no exception. Although saving OAuth2 tokens in browsers is convenient, tokens have expiration times and are issued by third parties, which can be a potential risk for clients and SDKs. Often, issues with third-party authentication services cause users to be unable to log in. Therefore, providing API Key access has become a better choice."><meta name=application-name content="An Li's Blog"><meta name=apple-mobile-web-app-title content="An Li's Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=http://kidylee.com/en/posts/adding-apikey-auth-in-existing-spring-project/><link rel=prev href=http://kidylee.com/en/posts/adding-auto-brightness-to-external-monitor/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"How to Add API Key Access Method for Spring Projects","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/kidylee.com\/en\/posts\/adding-apikey-auth-in-existing-spring-project\/"},"image":["http:\/\/kidylee.com\/favicon.jpeg"],"genre":"posts","keywords":"Java, Spring","wordcount":857,"url":"http:\/\/kidylee.com\/en\/posts\/adding-apikey-auth-in-existing-spring-project\/","datePublished":"2022-08-28T23:52:24+08:00","dateModified":"2022-08-28T23:52:24+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"An Li"},"description":""}</script></head><body data-header-desktop=auto data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/en/ title="An Li's Blog">An Li's Blog</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/en/posts/>Posts </a><a class=menu-item href=/en/tags/>Tags </a><a class=menu-item href=/en/categories/>Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class="menu-item language" title="Select Language"><i class="fa fa-globe" aria-hidden=true></i>
<select class=language-select id=language-select-desktop onchange="location=this.value"><option value=/en/posts/adding-apikey-auth-in-existing-spring-project/ selected>English</option><option value=/posts/adding-apikey-auth-in-existing-spring-project/>Chinese</option></select></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/en/ title="An Li's Blog">An Li's Blog</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/en/posts/ title>Posts</a><a class=menu-item href=/en/tags/ title>Tags</a><a class=menu-item href=/en/categories/ title>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a><a href=javascript:void(0); class=menu-item title="Select Language"><i class="fa fa-globe fa-fw" aria-hidden=true></i>
<select class=language-select onchange="location=this.value"><option value=/en/posts/adding-apikey-auth-in-existing-spring-project/ selected>English</option><option value=/posts/adding-apikey-auth-in-existing-spring-project/>Chinese</option></select></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">How to Add API Key Access Method for Spring Projects</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=https://kidylee.com title=Author target=_blank rel="noopener noreffer author" class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>An Li</a></span>&nbsp;<span class=post-category>included in <a href=/en/categories/programming/><i class="far fa-folder fa-fw" aria-hidden=true></i>Programming</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2022-08-28>2022-08-28</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;857 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;5 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src="https://source.unsplash.com/lPQIndZz8Mo/w=800" data-srcset="https://source.unsplash.com/lPQIndZz8Mo/w=800, https://source.unsplash.com/lPQIndZz8Mo/w=800 1.5x, https://source.unsplash.com/lPQIndZz8Mo/w=800 2x" data-sizes=auto alt="https://source.unsplash.com/lPQIndZz8Mo/w=800" title="https://source.unsplash.com/lPQIndZz8Mo/w=800"></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#implementation>Implementation</a><ul><li><a href=#obtaining-the-api-key-and-generating-authenticationtoken>Obtaining the API Key and Generating AuthenticationToken</a></li><li><a href=#custom-apikeyauthenticationprovider>Custom APIKeyAuthenticationProvider</a></li><li><a href=#apikeyauthenticationprovider-registery>APIKeyAuthenticationProvider Registery</a></li><li><a href=#work-to-be-done>Work to be done</a></li></ul></li><li><a href=#conclusion>Conclusion</a></li></ul></nav></div></div><div class=content id=content><p>Most technical SaaS platforms provide APIs for developers or to support clients and SDKs, and our company is no exception. Although saving OAuth2 tokens in browsers is convenient, tokens have expiration times and are issued by third parties, which can be a potential risk for clients and SDKs. Often, issues with third-party authentication services cause users to be unable to log in. Therefore, providing API Key access has become a better choice.</p><p>There are two approaches to adding API Key access:</p><ul><li>Reuse the existing Web API, introducing API Key authentication in parallel with the existing OAuth2-based services</li><li>Start a completely separate service, providing consistent services through code sharing.</li></ul><p>Both options have their pros and cons. In the early and middle stages of a product, when web and API access methods are roughly the same, the first approach may be better. However, when a project enters the middle and later stages, complete isolation may be a better choice considering the differences between web and API in terms of functionality and security. Since most of the web functionalities are consistent, we decided to add a parallel API Key authentication method on top of the existing OAuth2 authentication in the backend, making it more convenient for users.</p><p>This article mainly introduces the best practices for adding API Key authentication to existing Spring projects.</p><h2 id=implementation>Implementation</h2><div class="details admonition warning open"><div class="details-summary admonition-title"><i class="icon fas fa-exclamation-triangle fa-fw" aria-hidden=true></i>Attention!<i class="details-icon fas fa-angle-right fa-fw" aria-hidden=true></i></div><div class=details-content><div class=admonition-content>This method is only applicable to Spring Security &lt;= 5.2.2 (Spring Boot &lt;2.2.5). The latest Spring Security 5.7 (Spring Boot ^2.3.0) has bugs, and the API will undergo significant changes, making it unsuitable for this method. See the end of the article for details.</div></div></div><h3 id=obtaining-the-api-key-and-generating-authenticationtoken>Obtaining the API Key and Generating AuthenticationToken</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=nd>@Component</span><span class=o>(</span><span class=s>&#34;apiKeyFilter&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>APIKeyFilter</span> <span class=kd>extends</span> <span class=n>OncePerRequestFilter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>doFilterInternal</span><span class=o>(</span><span class=n>HttpServletRequest</span> <span class=n>request</span><span class=o>,</span> <span class=n>HttpServletResponse</span> <span class=n>response</span><span class=o>,</span> <span class=n>FilterChain</span> <span class=n>filterChain</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>ServletException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>authorization</span> <span class=o>=</span> <span class=n>request</span><span class=o>.</span><span class=na>getHeader</span><span class=o>(</span><span class=s>&#34;application-api-key&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>authorization</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>SecurityContextHolder</span><span class=o>.</span><span class=na>getContext</span><span class=o>().</span><span class=na>getAuthentication</span><span class=o>()</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>SecurityContext</span> <span class=n>emptyContext</span> <span class=o>=</span> <span class=n>SecurityContextHolder</span><span class=o>.</span><span class=na>createEmptyContext</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=n>emptyContext</span><span class=o>.</span><span class=na>setAuthentication</span><span class=o>(</span><span class=k>new</span> <span class=n>APIKeyAuthenticationToken</span><span class=o>(</span><span class=n>authorization</span><span class=o>));</span>
</span></span><span class=line><span class=cl>            <span class=n>SecurityContextHolder</span><span class=o>.</span><span class=na>setContext</span><span class=o>(</span><span class=n>emptyContext</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=n>filterChain</span><span class=o>.</span><span class=na>doFilter</span><span class=o>(</span><span class=n>request</span><span class=o>,</span> <span class=n>response</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Get the API Key by checking the HttpRequest header, wrap it in a custom <a href=https://github.com/kidylee/spring-new-authentication/blob/master/src/main/java/com/kidylee/spring/security/addnewauthentication/apikey/APIKeyAuthenticationToken.java target=_blank rel="noopener noreffer">Authentication Token</a>, and place it in the SecurityContext. Note that because Servlets operate in a multi-threaded environment, you should first create a new empty context and then set it back using setContext, rather than directly using <code>SecurityContextHolder.getContext().setAuthentication(token)</code>, which can lead to race conditions.</p><h3 id=custom-apikeyauthenticationprovider>Custom APIKeyAuthenticationProvider</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>APIKeyAuthenticationProvider</span> <span class=kd>implements</span> <span class=n>AuthenticationProvider</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>UserDetailsService</span> <span class=n>userDetailsService</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Authentication</span> <span class=nf>authenticate</span><span class=o>(</span><span class=n>Authentication</span> <span class=n>authentication</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>AuthenticationException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>apiKey</span> <span class=o>=</span> <span class=o>(</span><span class=n>String</span><span class=o>)</span> <span class=n>authentication</span><span class=o>.</span><span class=na>getCredentials</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>UserDetails</span> <span class=n>userdetails</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=n>userdetails</span> <span class=o>=</span> <span class=n>userDetailsService</span><span class=o>.</span><span class=na>loadUserByAPIKey</span><span class=o>(</span><span class=n>authentication</span><span class=o>.</span><span class=na>getPrincipal</span><span class=o>().</span><span class=na>toString</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>APIKeyAuthenticationToken</span> <span class=n>newAuth</span> <span class=o>=</span> <span class=k>new</span> <span class=n>APIKeyAuthenticationToken</span><span class=o>(</span><span class=n>userdetails</span><span class=o>,</span> <span class=n>userdetails</span><span class=o>.</span><span class=na>getAuthorities</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>newAuth</span><span class=o>.</span><span class=na>setAuthenticated</span><span class=o>(</span><span class=kc>true</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>newAuth</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>boolean</span> <span class=nf>supports</span><span class=o>(</span><span class=n>Class</span><span class=o>&lt;?&gt;</span> <span class=n>authentication</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>APIKeyAuthenticationToken</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>isAssignableFrom</span>
</span></span></code></pre></td></tr></table></div></div><p><code>ProviderManager</code> will match all <code>AuthenticationProviders</code> based on the Token in the <code>SecurityContext</code>, and the <code>supports</code> method is used for matching. Once matched, the <code>authenticate</code> method can be called for authentication. Here, you can obtain user information by querying the database or calling other services. Note that when handling <code>exception</code>s, any requests that fail authentication must be returned as an exception of the <code>AuthenticationException</code> subclass, so that Spring Filter can capture the exception and return the corresponding error message.</p><h3 id=apikeyauthenticationprovider-registery>APIKeyAuthenticationProvider Registery</h3><p>After custom this provider, the next step is register it into filter chain.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Configuration</span>
</span></span><span class=line><span class=cl><span class=nd>@EnableWebSecurity</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SecurityConfiguration</span> <span class=kd>extends</span> <span class=n>WebSecurityConfigurerAdapter</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>APIKeyFilter</span> <span class=n>apiKeyFilter</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>SecurityConfiguration</span><span class=o>(</span><span class=n>APIKeyFilter</span> <span class=n>apiKeyFilter</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>apiKeyFilter</span> <span class=o>=</span> <span class=n>apiKeyFilter</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>http</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>authorizeRequests</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>anyRequest</span><span class=o>().</span><span class=na>authenticated</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>http</span><span class=o>.</span><span class=na>sessionManagement</span><span class=o>().</span><span class=na>sessionCreationPolicy</span><span class=o>(</span><span class=n>SessionCreationPolicy</span><span class=o>.</span><span class=na>STATELESS</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>http</span><span class=o>.</span><span class=na>addFilterBefore</span><span class=o>(</span><span class=n>apiKeyFilter</span><span class=o>,</span> <span class=n>UsernamePasswordAuthenticationFilter</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>AuthenticationManagerBuilder</span> <span class=n>auth</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>auth</span><span class=o>.</span><span class=na>authenticationProvider</span><span class=o>(</span><span class=k>new</span> <span class=n>APIKeyAuthenticationProvider</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=work-to-be-done>Work to be done</h3><p>After Spring Security 5.7, <code>WebSecurityConfigurerAdapter</code> has been deprecated. The code modified according to the official documentation does not work properly. After the Token is set in the filter, <code>ProviderManager</code> did not trigger the call to our custom <code>APIKeyAuthenticationProvider</code>. This is probably a bug. In the community, there is an issue that combines the <code>AuthenticationManager</code> and <code>AuthenticationProvider</code> interfaces, so the solution to the problem with version 5.7 has been temporarily postponed.</p><h2 id=conclusion>Conclusion</h2><p>Compared with other languages, Java has a rich set of components and frameworks, but this is a double-edged sword: having many components allows for faster development speed, but also increases the learning cost. Spring Security can quickly complete 90% of the work, but the remaining 10% of special requirements may take three to five times longer to configure and debug.</p><p>I prefer the philosophy of being precise and efficient: if you haven&rsquo;t started using Java or Spring, I recommend choosing a simpler language and framework, such as Golang or Python; if you have already started using Spring Security, it is best to study it thoroughly and make full use of its features. Of course, as an open-source framework, Spring Security&rsquo;s design and implementation are worth learning.</p><h1 id=reference>Reference</h1><ul><li><p>Source code：<a href=https://github.com/kidylee/spring-new-authentication target=_blank rel="noopener noreffer">https://github.com/kidylee/spring-new-authentication</a></p></li><li><p><a href=https://www.baeldung.com/spring-security-authentication-provider target=_blank rel="noopener noreffer">Spring Security Custom Authentication Provider</a> Accessed 29 Aug. 2022.</p></li><li><p><a href=https://docs.spring.io/spring-security/reference/servlet/architecture.html target=_blank rel="noopener noreffer">Architecture :: Spring Security.</a> Accessed 29 Aug. 2022.</p></li><li><p><a href=https://docs.spring.io/spring-security/reference/servlet/authentication/architecture.html target=_blank rel="noopener noreffer">Servlet Authentication Architecture :: Spring Security</a> Accessed 29 Aug. 2022.</p></li><li><p><a href=https://spring.io/blog/2022/02/21/spring-security-without-the-websecurityconfigureradapter target=_blank rel="noopener noreffer">Spring Security without the WebSecurityConfigurerAdapter. 21 Feb. 2022</a> Accessed 29 Aug. 2022.</p></li></ul></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-08-28</span></div><div class=post-info-license><span>Creative Commons Attribution-ShareAlike 4.0 International License.</span></div></div><div class=post-info-line><div class=post-info-md></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=http://kidylee.com/en/posts/adding-apikey-auth-in-existing-spring-project/ data-title="How to Add API Key Access Method for Spring Projects" data-via=kidylee data-hashtags=Java,Spring><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=http://kidylee.com/en/posts/adding-apikey-auth-in-existing-spring-project/ data-hashtag=Java><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=http://kidylee.com/en/posts/adding-apikey-auth-in-existing-spring-project/ data-title="How to Add API Key Access Method for Spring Projects"><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=http://kidylee.com/en/posts/adding-apikey-auth-in-existing-spring-project/ data-title="How to Add API Key Access Method for Spring Projects"><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=http://kidylee.com/en/posts/adding-apikey-auth-in-existing-spring-project/ data-title="How to Add API Key Access Method for Spring Projects" data-image="https://source.unsplash.com/lPQIndZz8Mo/w=800" data-ralateuid=kidylee><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/en/tags/java/>Java</a>,&nbsp;<a href=/en/tags/spring/>Spring</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/en/>Home</a></span></section></div><div class=post-nav><a href=/en/posts/adding-auto-brightness-to-external-monitor/ class=prev rel=prev title="Adding Ambient Light Brightness Adjustment to External Monitors"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>Adding Ambient Light Brightness Adjustment to External Monitors</a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.111.3">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2019 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/en/ target=_blank>An Li</a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},lightgallery:!0,search:{highlightTag:"em",maxResultLength:10,noResultsFound:"No results found",snippetLength:30}}</script><script type=text/javascript src=/js/theme.min.js></script><script type=text/javascript>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-YWQ2PQBLY2",{anonymize_ip:!0})</script><script type=text/javascript src="https://www.googletagmanager.com/gtag/js?id=G-YWQ2PQBLY2" async></script></body></html>